<project>
    <description>Config diff runner</description>
    <properties>
        <hudson.model.ParametersDefinitionProperty>
            <parameterDefinitions>
                <hudson.model.StringParameterDefinition>
                    <name>release_line</name>
                    <defaultValue></defaultValue>
                    <description>Release version (e.g., 7.1.7-SP2 or 7.1.9->7.3.1)</description>
                </hudson.model.StringParameterDefinition>
                <hudson.model.StringParameterDefinition>
                    <name>source</name>
                    <defaultValue></defaultValue>
                    <description>Source version (e.g., CHF2 or CDH:gbn://123456)</description>
                </hudson.model.StringParameterDefinition>
                <hudson.model.StringParameterDefinition>
                    <name>target</name>
                    <defaultValue></defaultValue>
                    <description>Target version (e.g., CHF3 or CM:gbn://654321)</description>
                </hudson.model.StringParameterDefinition>
                <hudson.model.ChoiceParameterDefinition>
                    <name>dry_run</name>
                    <choices>
                        <string>true</string>
                        <string>false</string>
                    </choices>
                    <description>Dry run flag</description>
                </hudson.model.ChoiceParameterDefinition>
                <hudson.model.ChoiceParameterDefinition>
                    <name>launch_multiplier</name>
                    <choices>
                        <string>1</string>
                        <string>2</string>
                        <string>3</string>
                    </choices>
                    <description>Multiplier for running tests multiple times</description>
                </hudson.model.ChoiceParameterDefinition>
            </parameterDefinitions>
        </hudson.model.ParametersDefinitionProperty>
    </properties>
    <scm class="hudson.plugins.git.GitSCM">
        <userRemoteConfigs>
            <hudson.plugins.git.UserRemoteConfig>
                <url>https://github.com/torogeldiiev/diplomaWork</url>
                <credentialsId>github</credentialsId>
            </hudson.plugins.git.UserRemoteConfig>
        </userRemoteConfigs>
        <branches>
            <hudson.plugins.git.BranchSpec>
                <name>origin/master</name>
            </hudson.plugins.git.BranchSpec>
        </branches>
    </scm>
    <builders>
        <hudson.tasks.Shell>
        <command>
            #!/bin/bash

            # Load environment variables
            export $(grep -v '^#' "configs/local.env" | grep -v '^$' | xargs)

            # Create virtual environment if it doesn't exist
            if [ ! -d "venv" ]; then
                python3 -m venv venv
            fi

            # Activate virtual environment
            source venv/bin/activate
            pwd
            ls -l
            # Install dependencies
            pip install -r server/requirements.txt

            # Run tests
            pytest server/test/test_config_diff.py
        </command>
    </hudson.tasks.Shell>
    </builders>
</project>
